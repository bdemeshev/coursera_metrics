1
00:00:13,250 --> 00:00:19,558
Очень часто возникает потребность
графически изобразить информацию и,

2
00:00:19,558 --> 00:00:23,490
одновременно, о какой-то количественной
переменной, и о качественной переменной.

3
00:00:23,490 --> 00:00:26,736
Давайте посмотрим, как это можно сделать.

4
00:00:26,736 --> 00:00:31,120
Соответственно, во-первых, для корректной
работы многих графических функций

5
00:00:31,120 --> 00:00:32,827
да и многих функций, оценивающих модель,

6
00:00:32,827 --> 00:00:35,991
необходимо компьютеру указать,
что переменная является факторной,

7
00:00:35,991 --> 00:00:38,990
то есть принимает ограниченное
количество значений.

8
00:00:38,990 --> 00:00:44,374
Вот здесь по умолчанию, когда набор данных
прочитался в память из файла, компьютер

9
00:00:44,374 --> 00:00:50,132
распознал вот переменную kitchen span как,
или вот, допустим, distance как числовую.

10
00:00:50,132 --> 00:00:53,385
И вот у нее значение 12,5, 13,5.

11
00:00:53,385 --> 00:00:57,810
А, например, переменную brick он распознал
как integer, это означает «целое»,

12
00:00:57,810 --> 00:01:01,353
сокращение int,
а на самом деле она вовсе не целая,

13
00:01:01,353 --> 00:01:04,100
она не может принять значение 2 или 3.

14
00:01:04,100 --> 00:01:08,289
Она вот принимает именно значение 1 или 0,
то есть она, по сути, факторная,

15
00:01:08,289 --> 00:01:10,390
у неё ограничено количество значений.

16
00:01:10,390 --> 00:01:15,206
И поэтому для удобства
мы компьютеру укажем,

17
00:01:15,206 --> 00:01:18,780
какие переменные на самом
деле являются факторными.

18
00:01:18,780 --> 00:01:24,706
Значит, мы набор данных f изменим,
mutate_each,

19
00:01:24,706 --> 00:01:30,959
мы изменим несколько переменных в
наборе данных f, мы используем,

20
00:01:30,959 --> 00:01:35,729
будем использовать функцию factor,
и мы её применим к переменным: walk,

21
00:01:35,729 --> 00:01:41,050
она факторная, показывает, в пешей
доступности дом от метро или нет; brick,

22
00:01:41,050 --> 00:01:45,889
она факторная; floor,
первый-последний этаж, факторная; и code,

23
00:01:45,889 --> 00:01:50,400
на самом деле это код района Москвы,
но она тоже факторная.

24
00:01:50,400 --> 00:01:52,727
Соответственно, нажимаем Ctrl Enter.

25
00:01:52,727 --> 00:01:54,590
Визуально ничего не произошло,

26
00:01:54,590 --> 00:01:58,304
и, с точки зрения пользователя,
может и немного поменялось.

27
00:01:58,304 --> 00:02:03,694
Если я наберу glimpse(f),
снова посмотрю на набор данных f,

28
00:02:03,694 --> 00:02:06,963
то тот же самый набор данных,
только изменилась вот здесь надпись,

29
00:02:06,963 --> 00:02:09,120
что переменную теперь
компьютер считает факторной.

30
00:02:09,120 --> 00:02:14,480
Ну, поехали, построим первый график.

31
00:02:14,480 --> 00:02:22,903
Значит, возьму график
построю по набору данных f.

32
00:02:22,903 --> 00:02:32,495
По горизонтали я отложу
логарифм цены квартиры.

33
00:02:32,495 --> 00:02:37,178
И, соответственно,
если я построю такой график,

34
00:02:37,178 --> 00:02:41,070
компьютер просто построит
гистограмму логарифма цены квартиры.

35
00:02:41,070 --> 00:02:44,159
Теперь я его чуть-чуть видоизменю.

36
00:02:44,159 --> 00:02:50,490
Я хочу на том же графике учесть,
скажем, кирпичный дом или не кирпичный.

37
00:02:50,490 --> 00:02:54,680
Давайте я укажу, что закраска,
то есть цвет гистограммы,

38
00:02:54,680 --> 00:02:59,800
будет определяться переменной brick,
которая отвечает за кирпичность дома.

39
00:02:59,800 --> 00:03:01,956
И давайте на всякий случай...

40
00:03:01,956 --> 00:03:04,576
Ну давайте посмотрим, что получится.

41
00:03:04,576 --> 00:03:10,042
Вот у нас, соответственно,
получились две гистограммы.

42
00:03:10,042 --> 00:03:14,654
Ну здесь они наложены одна на другую,
чтобы получилась исходная.

43
00:03:14,654 --> 00:03:16,820
То есть давайте сравним
график с предыдущим.

44
00:03:16,820 --> 00:03:22,106
То есть получается, что вот эти
чёрные столбики исходной гистограммы

45
00:03:22,106 --> 00:03:26,701
компьютер поделил на две части: часть,
которая соответствует кирпичным домам,

46
00:03:26,701 --> 00:03:28,969
и часть,
которая соответствует не кирпичным домам.

47
00:03:28,969 --> 00:03:32,340
Ну из этого графика, например, я вижу,
что не кирпичных, красных, больше,

48
00:03:32,340 --> 00:03:34,160
чем кирпичных.

49
00:03:34,160 --> 00:03:39,025
И, соответственно, видно,
что кирпичные — у них

50
00:03:39,025 --> 00:03:42,970
логарифм цены чуть-чуть выше:
они чуть-чуть правее лежат.

51
00:03:42,970 --> 00:03:47,745
На этом графике, может быть, когда
гистограммы наложены друг на друга сверху,

52
00:03:47,745 --> 00:03:48,574
это не видно.

53
00:03:48,574 --> 00:03:53,460
А давайте мы чуть-чуть изменим
позицию гистограммы и выберем вариант,

54
00:03:53,460 --> 00:03:56,700
когда столбики чередуются: то красный,

55
00:03:56,700 --> 00:04:01,958
отвечающий за не кирпичные дома,
то столбик, отвечающий за кирпичные дома.

56
00:04:01,958 --> 00:04:08,698
Тут мы укажем опцию position="dodge"
и посмотрим, как это будет выглядеть.

57
00:04:08,698 --> 00:04:14,232
И вот здесь на этом графике уже столбики
диаграммы не друг над другом расположены,

58
00:04:14,232 --> 00:04:17,630
как на предыдущем,
— вот здесь столбики друг над другом,

59
00:04:17,630 --> 00:04:23,270
кирпичные над не кирпичными,
— а здесь они чередуются.

60
00:04:23,270 --> 00:04:28,135
И видно, что центр распределения здесь
правее лежит по сравнению с центром

61
00:04:28,135 --> 00:04:32,779
красного распределения, то есть цена,
логарифм цены, выше у кирпичных, и видно,

62
00:04:32,779 --> 00:04:37,410
что всё-таки красных больше,
чем таких сине-зелёных,

63
00:04:37,410 --> 00:04:42,390
соответственно, просто не
кирпичных домов больше.

64
00:04:42,390 --> 00:04:44,686
Вот мы видим это на этом графике.

65
00:04:44,686 --> 00:04:47,640
Также можно наложить функции плотности.

66
00:04:47,640 --> 00:04:53,850
То есть если я укажу тот же график,

67
00:04:53,850 --> 00:05:01,130
но укажу здесь опцию geom="density",

68
00:05:01,130 --> 00:05:06,430
то есть оценённой функции
плотности сглаженной гистограммы,

69
00:05:06,430 --> 00:05:08,608
то я получу вот такую вот картинку.

70
00:05:08,608 --> 00:05:12,390
Тут, правда, не совсем видно,
одна другую загораживает.

71
00:05:12,390 --> 00:05:17,107
Поэтому, чтобы они не
загораживали одна другую,

72
00:05:17,107 --> 00:05:23,090
мы укажем ещё опцию прозрачности alpha,
пусть будет alpha=0.5,

73
00:05:23,090 --> 00:05:26,944
чтоб они просвечивали и было
видно один на фоне другой.

74
00:05:26,944 --> 00:05:31,546
Ну вот здесь видно то же самое,
что красных, — нет, количество здесь уже

75
00:05:31,546 --> 00:05:36,483
не видно, площадь под функцией плотности
всегда отнормирована на единичку,

76
00:05:36,483 --> 00:05:42,390
— но видно, что всё-таки центр
распределения кирпичных домов правее,

77
00:05:42,390 --> 00:05:45,200
чем центр распределения
не кирпичных домов.

78
00:05:45,200 --> 00:05:50,876
Ну у нас качественных переменных много.

79
00:05:50,876 --> 00:05:55,506
У нас, например, качественной является
также расстояние, у нас качественной

80
00:05:55,506 --> 00:06:00,900
является также,
— на первом этаже или не на первом.

81
00:06:00,900 --> 00:06:06,232
Давайте мы к этому графику к последнему,
например, сделаем...

82
00:06:06,232 --> 00:06:12,150
Давайте объявим этот график базовым,
какой-нибудь график 2,

83
00:06:12,150 --> 00:06:17,204
нажмём Ctrl Enter,
и теперь чуть-чуть изменим

84
00:06:17,204 --> 00:06:22,128
график 2: мы добавим к
нему несколько фасеток,

85
00:06:22,128 --> 00:06:25,308
напишем facet_grid и укажем,

86
00:06:25,308 --> 00:06:29,835
что мы этот график разделим
на четыре графика,

87
00:06:29,835 --> 00:06:33,643
а именно: по одному измерению
мы будем откладывать,

88
00:06:33,643 --> 00:06:38,909
в пешей доступности дом или нет, а по
другому измерению мы будем откладывать,

89
00:06:38,909 --> 00:06:43,140
соответственно, на первом этаже
расположена квартира или нет.

90
00:06:43,140 --> 00:06:48,969
И получим вот уже другой график.

91
00:06:48,969 --> 00:06:51,180
Давайте посмотрим, что на нём видно.

92
00:06:56,495 --> 00:07:02,898
Соответственно, на нём видно,

93
00:07:02,898 --> 00:07:07,990
что если дом находится не в пешей
доступности и не на первом этаже,

94
00:07:07,990 --> 00:07:12,080
то на самом деле кирпичные и не
кирпичные почти не отличаются:

95
00:07:12,080 --> 00:07:14,296
центр распределения одинаковый.

96
00:07:14,296 --> 00:07:18,960
А вот здесь видно, что когда дом в
пешей доступности от метро и кирпичный,

97
00:07:18,960 --> 00:07:23,739
то цены для кирпичных и не кирпичных,
вот если посмотреть центр распределения,

98
00:07:23,739 --> 00:07:28,460
они уже существенно отличаются.

99
00:07:28,460 --> 00:07:32,760
Так, и что мы ещё можем посмотреть?

100
00:07:32,760 --> 00:07:38,210
Ну можно отказаться от двух измерений,
можно, например,

101
00:07:38,210 --> 00:07:44,880
посмотреть разницу только по тому,
на первом этаже или нет.

102
00:07:44,880 --> 00:07:49,480
Соответственно, здесь у
нас будет два графика.

103
00:07:49,480 --> 00:07:54,741
Идея грамматики графики,
то есть наложение каких-то

104
00:07:54,741 --> 00:07:59,907
стандартных преобразований графика,
она работает с любым базовым графиком,

105
00:07:59,907 --> 00:08:04,120
поэтому, например,
в качестве g2 мы могли взять гистограмму,

106
00:08:04,120 --> 00:08:09,350
а не оценку плотности, и точно так
же располагать её в виде фасеток.

