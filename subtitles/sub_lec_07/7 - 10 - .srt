1
00:00:12,145 --> 00:00:18,840
Второй этап- оценивание моделей.

2
00:00:18,840 --> 00:00:22,400
Оценивание моделей.

3
00:00:22,400 --> 00:00:26,440
Для начала оценим logit-модель.

4
00:00:26,440 --> 00:00:28,397
m_logit равняется.

5
00:00:28,397 --> 00:00:32,863
Logit-модель относится к классу
обобщенных линейных моделей.

6
00:00:32,863 --> 00:00:36,618
То есть R позволяет оценивать
не только logit и probit модели,

7
00:00:36,618 --> 00:00:38,873
но и гораздо более широкий класс моделей,

8
00:00:38,873 --> 00:00:42,210
поэтому отсюда сокращение GLM
— generalized linear models.

9
00:00:42,210 --> 00:00:44,851
Данные мы берем,
как всегда, из таблички T.

10
00:00:44,851 --> 00:00:48,173
Формула, по которой мы
оцениваем переменную survived,

11
00:00:48,173 --> 00:00:53,370
мы пытаемся предсказать с помощью пола,

12
00:00:53,370 --> 00:00:59,130
возраста, класса,
которым ехал пассажир, и тарифа.

13
00:00:59,130 --> 00:01:03,600
Здесь надо указать теперь,
что мы имеем в виду logit-модель.

14
00:01:03,600 --> 00:01:08,070
Logit-модель относится к
классу биномиальных моделей.

15
00:01:08,070 --> 00:01:11,450
Фамилия = binomial.

16
00:01:11,450 --> 00:01:17,039
И связующая функция
называется logit-функцией.

17
00:01:17,039 --> 00:01:22,291
И также нам надо указать, чтобы
компьютер сохранил исходные регрессоры

18
00:01:22,291 --> 00:01:26,420
в оцененной модели, это нам понадобится
для оценки предельных эффектов.

19
00:01:26,420 --> 00:01:30,510
Все готово, мы оценили logit-модель.

20
00:01:30,510 --> 00:01:34,070
Аналогичным кодом сразу
давайте оценим probit-модель.

21
00:01:34,070 --> 00:01:39,757
Нам требуется небольшая корректировка,
m_probit равняется,

22
00:01:39,757 --> 00:01:43,930
все параметры точно такие же,
кроме связующей функции.

23
00:01:43,930 --> 00:01:46,150
Связующая функция — probit.

24
00:01:46,150 --> 00:01:53,160
Выполняем эту команду и смотрим на
результаты оценивая, summary logit-модели.

25
00:01:53,160 --> 00:01:57,630
Что мы видим в отчете по logit-модели?

26
00:01:57,630 --> 00:02:03,850
Мы видим оценки коэффициентов,
коэффициент при возрасте: -0,03.

27
00:02:03,850 --> 00:02:08,230
Коэффициент при дамми-переменной,
отвечающей за пассажиров второго класса,

28
00:02:08,230 --> 00:02:13,299
коэффициент при дамми-переменной,
отвечающей за пассажиров третьего класса,

29
00:02:13,299 --> 00:02:15,524
коэффициент при тарифе.

30
00:02:15,524 --> 00:02:19,071
Уже видно,
что знаки оправдывают наши ожидания.

31
00:02:19,071 --> 00:02:22,307
Например, при возрасте
коэффициент отрицательный,

32
00:02:22,307 --> 00:02:24,785
а при тарифе коэффициент положительный.

33
00:02:24,785 --> 00:02:30,786
То есть тариф, то есть стоимость билета
положительно влияла на вероятность выжить.

34
00:02:30,786 --> 00:02:36,340
Аналогично можно посмотреть
отчет краткий по probit-модели.

35
00:02:36,340 --> 00:02:41,099
Мы говорили, что logit-модель и

36
00:02:41,099 --> 00:02:47,195
probit-модель по сути, по вопросу
прогнозирования отличаются не существенно,

37
00:02:47,195 --> 00:02:51,807
и только в силу масштабирования скрытой
переменной коэффициенты в logit-модели

38
00:02:51,807 --> 00:02:55,630
отличаются от коэффициентов в
probit-модели примерно в 1,6 раза.

39
00:02:55,630 --> 00:02:57,134
И это соотношение заметно.

40
00:02:57,134 --> 00:03:02,428
Например, коэффициент при
возрасте в probit-модели: -0,019,

41
00:03:02,428 --> 00:03:08,620
в то время как коэффициент при
возрасте в logit-модели: -0,034.

42
00:03:08,620 --> 00:03:13,070
Выпишем и проинтерпретируем
уравнения полученной регрессии.

43
00:03:13,070 --> 00:03:17,536
У нас logit-модель, поэтому мы моделируем

44
00:03:17,536 --> 00:03:22,451
логорифм отношения шансов,
то есть логарифм дроби, вероятность того,

45
00:03:22,451 --> 00:03:26,870
что y = 1, деленное на вероятность того,
что y = 0.

46
00:03:26,870 --> 00:03:27,740
И он равен.

47
00:03:27,740 --> 00:03:32,960
Естественно, идет речь об оценках,
поэтому мы пишем крышечку над P.

48
00:03:32,960 --> 00:03:40,270
Теперь проинтерпретируем

49
00:03:40,270 --> 00:03:43,756
полученное уравнение регрессии,
отдельные коэффициенты.

50
00:03:43,756 --> 00:03:47,580
Рассмотрим коэффициент перед
непрерывной переменной — возраст.

51
00:03:47,580 --> 00:03:51,770
И перед переменной дискретной — пол.

52
00:03:51,770 --> 00:03:56,880
Sex male, которая равна 1, если пассажир
— мужчина, и 0, если пассажир — женщина.

53
00:03:56,880 --> 00:04:01,840
Коэффициент β2 с крышкой при age

54
00:04:01,840 --> 00:04:07,409
= -0,03 Это означает,

55
00:04:07,409 --> 00:04:12,450
что с ростом переменной «возраст» на 1,

56
00:04:12,450 --> 00:04:17,510
то есть на 1 год (она измеряется в годах)

57
00:04:17,510 --> 00:04:22,222
отношение шансов P с крышечкой (y =

58
00:04:22,222 --> 00:04:27,140
1) делить на P с крышечкой (y = 0),

59
00:04:27,140 --> 00:04:31,450
это отношение шансов падает,
раз коэффициент отрицательный,

60
00:04:31,450 --> 00:04:36,360
и падает оно на… умножаем на 100,

61
00:04:36,360 --> 00:04:40,680
получаем процентное падение на 3 %.

62
00:04:40,680 --> 00:04:43,915
Аналогично можно проинтерпретировать
коэффициент при любой

63
00:04:43,915 --> 00:04:47,400
непрерывной переменной, например,
при переменной «тариф».

64
00:04:47,400 --> 00:04:54,487
β с крышкой fare = 0,0003,

65
00:04:54,487 --> 00:04:58,728
значит с ростом

66
00:04:58,728 --> 00:05:03,863
тарифа на одну единицу (он

67
00:05:03,863 --> 00:05:08,539
измерялся в фунтах) логарифмическое

68
00:05:08,539 --> 00:05:14,203
отношение шансов,
то есть отношение вероятности того,

69
00:05:14,203 --> 00:05:19,150
что y = 1 к вероятности того, что y = 0,

70
00:05:19,150 --> 00:05:24,689
растет на 0,0003, а само отношение

71
00:05:24,689 --> 00:05:30,420
шансов растет на 0,03 %.

72
00:05:35,720 --> 00:05:41,020
Теперь мы этот кусочек стираем,
и здесь я интерпретирую

73
00:05:41,020 --> 00:05:46,840
дискретный коэффициент,
поскольку он тяжелее интерпретируется.

74
00:05:46,840 --> 00:05:55,161
Теперь проинтерпретируем
качественный коэффициент «пол»,

75
00:05:55,161 --> 00:05:59,700
который принимает значения: 0
базовой категории для женщин и 1,

76
00:05:59,700 --> 00:06:03,560
переменная sex male = 1, для мужчин.

77
00:06:03,560 --> 00:06:06,442
Здесь величина коэффициента большая,

78
00:06:06,442 --> 00:06:10,496
поэтому интерпретировать
производную очень плохо,

79
00:06:10,496 --> 00:06:16,240
лучше посчитать изменения именно
аккуратно, с учетом экспоненты.

80
00:06:16,240 --> 00:06:18,347
Соответственно, что мы получим?

81
00:06:18,347 --> 00:06:26,153
Если логарифм отношения шансов,
если логарифм отношения шансов,

82
00:06:26,153 --> 00:06:30,510
в него входит в качестве составной

83
00:06:30,510 --> 00:06:35,631
части: -2,49 умножить на дамми-переменную,

84
00:06:35,631 --> 00:06:41,530
обозначающую пол участника, то это
означает, что само отношение шансов,

85
00:06:41,530 --> 00:06:47,170
вероятность того, что y = 1 делить
на вероятность того, что y = 0,

86
00:06:47,170 --> 00:06:52,360
это есть экспонента,

87
00:06:52,360 --> 00:06:58,963
от -2,49, помножить на дамми-переменную,

88
00:06:58,963 --> 00:07:03,997
обозначающую пол участника,
помножить на остальные составляющие.

89
00:07:03,997 --> 00:07:09,161
Соответственно, при изменении,
при сравнении двух пассажиров,

90
00:07:09,161 --> 00:07:14,340
одного с женским полом,
женщины и мужчины, мы получим,

91
00:07:14,340 --> 00:07:21,465
что отношение шансов меняется
в экспоненту от -2,49 раз.

92
00:07:21,465 --> 00:07:28,461
То есть, если переменная sex
male меняется от 0 до 1,

93
00:07:28,461 --> 00:07:34,774
то есть мы сравниваем двух пассажиров
— женщину и мужчину, то получается,

94
00:07:34,774 --> 00:07:40,675
что это отношение шансов домножается,
вернее,

95
00:07:40,675 --> 00:07:46,961
делится на экспоненту от 2,49,
это примерно 12.

96
00:07:46,961 --> 00:07:51,710
То есть мы можем сказать,
что отношение шансов,

97
00:07:51,710 --> 00:07:57,040
шансы у женщин примерно в 12 раз больше,
чем у мужчин.

98
00:07:57,040 --> 00:08:03,312
Раз коэффициент отрицательный, значит при
переходе от 0 к 1 отношение шансов падает.

99
00:08:03,312 --> 00:08:07,300
И отношение шансов падает
примерно в 12 раз.

100
00:08:07,300 --> 00:08:14,560
Мы можем посмотреть на ковариационную
матрицу оцененных коэффициентов.

101
00:08:14,560 --> 00:08:22,030
Ковариационная матрица.

102
00:08:22,030 --> 00:08:27,700
А именно

103
00:08:27,700 --> 00:08:31,620
variance covariance
matrix от модели logit.

104
00:08:31,620 --> 00:08:36,329
Соответственно, например,
эта матрица показывает,

105
00:08:36,329 --> 00:08:40,938
что оценка дисперсии
свободного члена равна 0,14.

106
00:08:40,938 --> 00:08:48,010
Например, оценка ковариации
между коэффициентом

107
00:08:48,010 --> 00:08:54,840
при поле и свободным членом
равна: -2,6 на 10 в -2-ой.

108
00:08:54,840 --> 00:08:57,184
Как мы уже говорили, к сожалению,

109
00:08:57,184 --> 00:09:01,107
коэффициенты в logit и probit
моделях интерпретируются плохо.

110
00:09:01,107 --> 00:09:04,750
Гораздо проще интерпретировать
спрогнозированные вероятности или

111
00:09:04,750 --> 00:09:06,020
предельные эффекты.

112
00:09:06,020 --> 00:09:10,097
На сколько увеличивается вероятность
выжить при росте одной или другой

113
00:09:10,097 --> 00:09:11,180
переменной на 1.

114
00:09:11,180 --> 00:09:16,230
Давайте перейдем к задаче прогнозирования
и задаче оценки предельных эффектов.

115
00:09:16,230 --> 00:09:21,683
Для начала мы

116
00:09:21,683 --> 00:09:26,850
создадим новый искусственный набор данных,
для которого и будем прогнозировать.

117
00:09:26,850 --> 00:09:30,960
Создадим новый набор данных — new data.

118
00:09:30,960 --> 00:09:36,330
В новых набор данных, это у нас будет
data frame, табличка с данными,

119
00:09:36,330 --> 00:09:41,729
Скажем, мы спрогнозируем
вероятность выжить для мужчин,

120
00:09:41,729 --> 00:09:45,610
которые едут 2-м классом
всех возможных возрастов.

121
00:09:45,610 --> 00:09:51,270
Соответственно, мы установим,
что age меняется.

122
00:09:51,270 --> 00:09:58,384
Последовательность от,
скажем, 5-ти до 100 лет.

123
00:09:58,384 --> 00:10:05,360
И рассмотрим 100 разных
возрастов от 5 до 100.

124
00:10:05,360 --> 00:10:10,710
Укажем, что пол нас,

125
00:10:10,710 --> 00:10:13,874
нас интересуют мужчины.

126
00:10:13,874 --> 00:10:16,610
Укажем класс 2-ой.

127
00:10:16,610 --> 00:10:21,410
И надо указать еще тариф,
ну давайте возьмем тариф

128
00:10:21,410 --> 00:10:25,845
равный 100.

129
00:10:25,845 --> 00:10:29,811
Выполняем нашу команду.

130
00:10:29,811 --> 00:10:33,057
Это команда нам создала
новый набор данных.

131
00:10:33,057 --> 00:10:36,373
Можем для удобства,
чтобы его легче было представлять,

132
00:10:36,373 --> 00:10:39,603
просто посмотрим,
что находится в наборе new data.

133
00:10:39,603 --> 00:10:43,005
В наборе new data есть
переменная «возраст»,

134
00:10:43,005 --> 00:10:46,383
меняющийся потихоньку от 5 до 100,
переменная «пол»,

135
00:10:46,383 --> 00:10:51,276
которая равна мужчине, переменная
«класс» 2-ой, переменная «тариф» 100.

136
00:10:51,276 --> 00:10:56,076
Соответственно, для всех этих наблюдений
мы сейчас построим прогнозы по модели

137
00:10:56,076 --> 00:10:56,764
logit.

138
00:10:56,764 --> 00:11:00,310
Строим прогнозы для этого набора данных.

139
00:11:00,310 --> 00:11:05,560
Прогнозы по logit-модели

140
00:11:05,560 --> 00:11:10,129
= команда predict,
мы используем logit-модель,

141
00:11:10,129 --> 00:11:14,578
m_logIt, используем набор
данных new data и, поскольку

142
00:11:14,578 --> 00:11:19,431
мы хотим строить не только точечные
прогнозы, но и доверительные интервалы,

143
00:11:19,431 --> 00:11:24,575
то указываем, что нам нужны
стандартные ошибки, se = TRUE.

144
00:11:24,575 --> 00:11:29,122
Замечательно, у нас вылезла ошибка,

145
00:11:29,122 --> 00:11:33,200
когда у вас вылезает ошибка,
не пугайтесь, прочитайте и исправьте.

146
00:11:33,200 --> 00:11:34,692
Тут написано, что не найдет fare.

147
00:11:34,692 --> 00:11:38,079
Ну, соответственно, это я просто
опечатался и назвал «тариф» по-русски,

148
00:11:38,079 --> 00:11:40,240
когда надо было назвать
'fare' по-английски.

149
00:11:40,240 --> 00:11:44,400
Исправляем и снова запускаем
наши несколько команд.

150
00:11:44,400 --> 00:11:47,661
Теперь прогнозы прекрасно построились.

151
00:11:47,661 --> 00:11:52,459
Давайте объединим наш набор new data
и «прогнозы» в один и посмотрим,

152
00:11:52,459 --> 00:11:53,775
что у нас получится.

153
00:11:53,775 --> 00:12:00,034
New data с прогнозами, поскольку мы
объединяем столбики, то эта команда cbind,

154
00:12:00,034 --> 00:12:06,882
и мы объединяем набор данных new data и
прогнозы, построенные по logit-модели.

155
00:12:06,882 --> 00:12:13,550
Давайте посмотрим, что у нас получилось.

156
00:12:13,550 --> 00:12:19,602
Видна переменная: возраст,
пол, класс пассажира,

157
00:12:19,602 --> 00:12:25,779
тариф fare, fit — это предсказанная,
скрытая переменная y со звездочкой,

158
00:12:25,779 --> 00:12:29,801
и se.fit — это стандартная
ошибка данной переменной.

159
00:12:29,801 --> 00:12:30,357
Residual.

160
00:12:30,357 --> 00:12:34,090
scale — это какой-то вспомогательный…
единичка, она нам не понадобится.

