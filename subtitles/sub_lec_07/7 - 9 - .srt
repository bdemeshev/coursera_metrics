1
00:00:13,270 --> 00:00:19,450
На сегодняшнем практическом занятии
мы будем исследовать набор данных

2
00:00:19,450 --> 00:00:24,791
о пассажирах «Титаника» и с помощью логит-
и пробит-моделей попытаемся определить,

3
00:00:24,791 --> 00:00:28,833
какие факторы влияют на
вероятность выживания пассажира.

4
00:00:28,833 --> 00:00:33,266
Как всегда запускаем R-studio,
открываем заготовку

5
00:00:33,266 --> 00:00:38,170
рабочего файла lab_07_beforeR, убеждаемся,

6
00:00:38,170 --> 00:00:44,310
что установлена верная рабочая папка,
в которой хранится файл с данными,

7
00:00:44,310 --> 00:00:48,930
Session Set Working Directory
To Source File Location,

8
00:00:48,930 --> 00:00:55,011
загружаем необходимые библиотеки,
загружаем файл с данными.

9
00:00:55,011 --> 00:00:58,460
После того как мы
загрузили файл с данными,

10
00:00:58,460 --> 00:01:02,030
обязательно нужно посмотреть,
а что же мы, собственно, загрузили.

11
00:01:02,030 --> 00:01:09,274
Мы видим, что набор данных состоит
из большого количества переменных.

12
00:01:09,274 --> 00:01:12,560
Ну, можно отметить pclass — класс,
которым ехал пассажир,

13
00:01:12,560 --> 00:01:17,640
survived — выжил пассажир или нет,
sex — пол пассажира,

14
00:01:17,640 --> 00:01:22,780
возраст и тариф — цены билета.

15
00:01:22,780 --> 00:01:26,152
Неплохо также сделать вывод о том,

16
00:01:26,152 --> 00:01:31,157
что некоторые переменные являются
качественными или факторными,

17
00:01:31,157 --> 00:01:34,876
а именно — класс пассажира является
факторной переменной: либо первый,

18
00:01:34,876 --> 00:01:38,880
либо второй, либо третий; переменная
выжил/ не выжил не может принимать

19
00:01:38,880 --> 00:01:44,211
значение 1,5 или 0,7; переменная sex
также является факторной: либо male,

20
00:01:44,211 --> 00:01:48,002
либо female,
и также еще порт посадки пассажира также

21
00:01:48,002 --> 00:01:52,610
является факторной переменной,
но мы ее не будем исследовать.

22
00:01:52,610 --> 00:01:58,265
Соответственно, надо указать R,
что данные переменные являются факторными.

23
00:01:58,265 --> 00:02:01,923
Соответственно, мы сделаем первое
преобразование нашего набора

24
00:02:01,923 --> 00:02:06,461
данных t mutate(t) и укажем,

25
00:02:06,461 --> 00:02:11,770
что переменная «пол» должна
быть факторной as.factor,

26
00:02:11,770 --> 00:02:16,370
sex переменная pclass

27
00:02:16,370 --> 00:02:21,410
является факторной,

28
00:02:21,410 --> 00:02:26,565
и переменная survived

29
00:02:26,565 --> 00:02:31,590
также является факторной.

30
00:02:37,025 --> 00:02:41,369
Вот опечатка, pclass пропущена буква c.

31
00:02:41,369 --> 00:02:42,460
Отлично.

32
00:02:42,460 --> 00:02:47,739
После этого можно посмотреть описательные
статистики — summary набора данных t,

33
00:02:47,739 --> 00:02:51,450
посмотреть описательные
статистики по каждой переменной.

34
00:02:51,450 --> 00:02:54,537
Например, можно посмотреть
на переменную пол.

35
00:02:54,537 --> 00:02:58,210
Видно, что у нас 466 женщин и 843 мужчины.

36
00:02:58,210 --> 00:03:01,370
Можно посмотреть на переменную возраст.

37
00:03:01,370 --> 00:03:05,097
Средний возраст был примерно 30 лет,
максимальный — 80,

38
00:03:05,097 --> 00:03:07,450
а минимальный — это ребенок до 1 года.

39
00:03:07,450 --> 00:03:12,376
После этого необходимо
обязательно построить графики,

40
00:03:12,376 --> 00:03:15,850
обязательно смотрите на
ваши данные на графиках.

41
00:03:15,850 --> 00:03:20,870
Когда у вас есть зависимая
объясняемая качественная переменная,

42
00:03:20,870 --> 00:03:25,029
то, как правило, имеет смысл
рассмотреть несколько графиков: график,

43
00:03:25,029 --> 00:03:29,661
где вы пытаетесь ее объяснить с помощью
другой качественной переменной и график,

44
00:03:29,661 --> 00:03:33,661
где вы ее пытаетесь объяснить с помощью
другой количественной переменной.

45
00:03:33,661 --> 00:03:36,300
Давайте рассмотрим эти
несколько типов графиков.

46
00:03:36,300 --> 00:03:39,959
Построим замечательный мозаичный график.

47
00:03:39,959 --> 00:03:44,552
mosaic, дальше рисуем тильдочку
и указываем переменные,

48
00:03:44,552 --> 00:03:48,500
несколько качественных
переменных от двух до...

49
00:03:48,500 --> 00:03:51,885
разумно, наверное, до трех,
но можно и больше.

50
00:03:51,885 --> 00:03:57,077
Возьмем переменные пол,
класс пассажира (passenger class)

51
00:03:57,077 --> 00:04:05,470
и выжил/ не выжил (survived) и установим
опцию цветовой закраски shade=TRUE.

52
00:04:05,470 --> 00:04:07,463
Смотрим, что у нас...

53
00:04:07,463 --> 00:04:09,818
Я забыл указать набор данных.

54
00:04:09,818 --> 00:04:13,450
Указываем, что данные
мы берем из таблички t,

55
00:04:13,450 --> 00:04:17,681
и у нас получается
замечательный мозаичный график.

56
00:04:17,681 --> 00:04:19,572
Что на этом графике видно?

57
00:04:19,572 --> 00:04:21,372
На этом графике видно, на самом деле,

58
00:04:21,372 --> 00:04:24,930
соотношение между всеми качественными
переменными в нашем наборе данных.

59
00:04:24,930 --> 00:04:30,510
Давайте посмотрим, сначала мы делили нашу
выборку по переменной sex — по полу.

60
00:04:30,510 --> 00:04:34,460
Вот мы видим,
что женщин существенно меньше, чем мужчин.

61
00:04:34,460 --> 00:04:39,033
Затем всех женщин мы делили на тех,
кто ехал в первом классе,

62
00:04:39,033 --> 00:04:40,577
во втором и в третьем.

63
00:04:40,577 --> 00:04:45,240
Видно, что в третьем классе женщин
ехало больше, чем во втором и больше,

64
00:04:45,240 --> 00:04:46,027
чем в первом.

65
00:04:46,027 --> 00:04:48,192
А во втором меньше всего ехало женщин.

66
00:04:48,192 --> 00:04:52,131
Если посмотреть на отделение мужчин
по классам, то, опять же, видно,

67
00:04:52,131 --> 00:04:55,745
что больше половины мужчин
ехало в третьем классе.

68
00:04:55,745 --> 00:05:00,294
И точно так же дальше мужчины и
женщины каждого класса делятся на

69
00:05:00,294 --> 00:05:01,495
выживших и не выживших.

70
00:05:01,495 --> 00:05:04,958
Ну, например, если посмотреть на
женщин третьего класса, то видно,

71
00:05:04,958 --> 00:05:07,950
что примерно половина из них выжили,
а половина из них не выжили.

72
00:05:07,950 --> 00:05:10,677
Если посмотреть на мужчин третьего класса,

73
00:05:10,677 --> 00:05:14,321
то большая часть из них не выжили
и меньшая часть из них выжили.

74
00:05:14,321 --> 00:05:17,600
Ежели, например,
посмотреть на женщин первого класса,

75
00:05:17,600 --> 00:05:21,590
то из них не выжило очень
мало и выжило большинство.

76
00:05:21,590 --> 00:05:25,639
Цветовая закраска соответствует
автоматической проверке гипотезы о

77
00:05:25,639 --> 00:05:27,260
независимости признаков.

78
00:05:27,260 --> 00:05:32,065
Соответственно, синие клеточки означают,
что в эту

79
00:05:32,065 --> 00:05:36,870
категорию попадает больше наблюдений, чем
попадало бы при независимости признаков,

80
00:05:36,870 --> 00:05:41,881
а красные клеточки означают, что в эту
категорию попадает меньше наблюдений,

81
00:05:41,881 --> 00:05:44,840
чем попадало бы при
независимости признаков.

82
00:05:44,840 --> 00:05:50,630
Построим следующий график,

83
00:05:50,630 --> 00:05:57,320
построим график,
который называется «виолончель».

84
00:05:57,320 --> 00:06:02,454
Берем данные из набора t,
по горизонтали мы

85
00:06:02,454 --> 00:06:07,315
отложим выжил человек или не выжил,

86
00:06:07,315 --> 00:06:13,153
а по вертикали отложим, например, возраст.

87
00:06:13,153 --> 00:06:19,130
И тип графика укажем — виолончель violin.

88
00:06:23,280 --> 00:06:27,198
Соответственно, на этом
графике что мы видим?

89
00:06:27,198 --> 00:06:31,659
Если поделить пассажиров на выживших
и не выживших и отложить по

90
00:06:31,659 --> 00:06:36,517
вертикали количественную переменную,
а именно возраст, то мы видим,

91
00:06:36,517 --> 00:06:41,638
что возраст меняется от нуля практически
до 80, и распределение по возрастам

92
00:06:41,638 --> 00:06:47,465
среди выживших и не выживших
примерно одинаковое.

93
00:06:47,465 --> 00:06:52,588
Вместо графика «виолончели» раньше обычно

94
00:06:52,588 --> 00:06:58,589
традиционно строили график, который
называется «диаграмма ящик с усами».

95
00:06:58,589 --> 00:07:01,842
Давайте мы его построим,
чтобы не нарушать традицию,

96
00:07:01,842 --> 00:07:06,468
хотя, на мой личный взгляд,
«виолончель» гораздо красивее.

97
00:07:06,468 --> 00:07:12,118
Команда ничем не отличается,
кроме указания типа графика.

98
00:07:12,118 --> 00:07:16,236
По горизонтали откладываем выжил или не
выжил пассажир, по вертикали откладываем

99
00:07:16,236 --> 00:07:21,250
возраст, однако тип
графика указываем boxplot.

100
00:07:21,250 --> 00:07:27,202
Здесь также видно на этом старом графике,

101
00:07:27,202 --> 00:07:31,160
что распределение по возрастам у
выживших и не выживших совпадает.

102
00:07:31,160 --> 00:07:35,576
Следующий тип графика, мы наложим
функцию плотности для выживших и не

103
00:07:35,576 --> 00:07:39,400
выживших пассажиров на одном графике.

104
00:07:39,400 --> 00:07:43,707
Соответственно, qplot, данные мы
берем из той же самой таблички t.

105
00:07:43,707 --> 00:07:48,407
По горизонтали на этот раз мы отложим
возраст, по вертикали откладывается,

106
00:07:48,407 --> 00:07:52,790
соответственно, количество наблюдений,
его сам компьютер посчитает.

107
00:07:52,790 --> 00:07:56,892
Закрасим мы fill, опция fill,
в соответствии с тем,

108
00:07:56,892 --> 00:07:59,130
выжил или не выжил пассажир.

109
00:07:59,130 --> 00:08:06,050
Тип графика — это будет оцененная
функция плотности geom="density",

110
00:08:06,050 --> 00:08:10,684
и, соответственно, поскольку у нас
функций плотности оценивается сразу две,

111
00:08:10,684 --> 00:08:14,363
то надо компьютеру сказать,
как они должны быть расположены.

112
00:08:14,363 --> 00:08:19,270
Для начала я рассмотрю опцию,
когда они накапливаются по вертикали,

113
00:08:19,270 --> 00:08:24,445
position равняется stack.

114
00:08:24,445 --> 00:08:31,574
Вот, можно посмотреть на этот
график в увеличенном варианте,

115
00:08:31,574 --> 00:08:36,180
я вижу, опять же, здесь,
что возраст у меня меняется от 0 до 80.

116
00:08:36,180 --> 00:08:40,867
Видно, вот если так присмотреться на
кончик графика, то можно заметить,

117
00:08:40,867 --> 00:08:45,780
что самый пожилой пассажир выжил.

118
00:08:45,780 --> 00:08:50,587
Точно так же можно рассмотреть
условную вероятность.

119
00:08:50,587 --> 00:08:55,490
Для этого мы практически полностью
продублируем предыдущую команду,

120
00:08:55,490 --> 00:09:00,630
только заменим опцию position="stack"

121
00:09:00,630 --> 00:09:05,560
на position="fill" и мы получим
сглаженную условную вероятность.

122
00:09:11,605 --> 00:09:13,617
Что нам говорит этот график?

123
00:09:13,617 --> 00:09:19,803
Этот график нам говорит, что среди совсем
юных пассажиров большая часть выжила,

124
00:09:19,803 --> 00:09:25,410
среди пассажиров пожилого
возраста большая часть погибла.

125
00:09:25,410 --> 00:09:29,225
И вот это последнее наблюдение: этот
график не отражает количество людей,

126
00:09:29,225 --> 00:09:30,868
а отражает только соотношение.

127
00:09:30,868 --> 00:09:33,747
И мы видим,
что вот самый пожилой он все-таки выжил.

128
00:09:33,747 --> 00:09:37,707
После того как мы проанализировали
данные графически,

129
00:09:37,707 --> 00:09:40,190
можно переходить к оценке модели.

130
00:09:40,190 --> 00:09:46,100
Мы оценим логит-

131
00:09:46,100 --> 00:09:51,370
и пробит-модели.

